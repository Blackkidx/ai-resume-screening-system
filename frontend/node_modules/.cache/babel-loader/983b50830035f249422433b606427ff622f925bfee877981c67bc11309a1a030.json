{"ast":null,"code":"var _s = $RefreshSig$();\n// frontend/src/hooks/useProfile.js - Custom Hook สำหรับจัดการ Profile\nimport { useState, useEffect } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nconst useProfile = () => {\n  _s();\n  const {\n    user,\n    isAuthenticated\n  } = useAuth();\n  const [profile, setProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // ฟังก์ชันดึงข้อมูล Profile\n  const fetchProfile = async () => {\n    if (!isAuthenticated() || !user) {\n      setLoading(false);\n      return;\n    }\n    try {\n      setLoading(true);\n      setError(null);\n      const token = localStorage.getItem('access_token');\n      const response = await fetch('http://localhost:8000/api/auth/profile/', {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      if (response.ok) {\n        const profileData = await response.json();\n        setProfile(profileData);\n      } else {\n        throw new Error('ไม่สามารถดึงข้อมูลโปรไฟล์ได้');\n      }\n    } catch (err) {\n      console.error('Error fetching profile:', err);\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // ฟังก์ชันอัพเดต Profile\n  const updateProfile = async formData => {\n    if (!isAuthenticated()) {\n      throw new Error('กรุณาเข้าสู่ระบบ');\n    }\n    try {\n      const token = localStorage.getItem('access_token');\n      const response = await fetch('http://localhost:8000/api/auth/profile/', {\n        method: 'PUT',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        },\n        body: formData // ใช้ FormData สำหรับการอัพโหลดไฟล์\n      });\n      if (response.ok) {\n        const updatedProfile = await response.json();\n        setProfile(updatedProfile);\n        return {\n          success: true,\n          data: updatedProfile\n        };\n      } else {\n        const errorData = await response.json();\n        throw new Error(errorData.detail || 'ไม่สามารถอัพเดตโปรไฟล์ได้');\n      }\n    } catch (err) {\n      console.error('Error updating profile:', err);\n      throw err;\n    }\n  };\n\n  // ฟังก์ชันอัพโหลดรูปโปรไฟล์\n  const uploadProfileImage = async imageFile => {\n    if (!isAuthenticated()) {\n      throw new Error('กรุณาเข้าสู่ระบบ');\n    }\n    try {\n      const formData = new FormData();\n      formData.append('profile_image', imageFile);\n      const token = localStorage.getItem('access_token');\n      const response = await fetch('http://localhost:8000/api/auth/upload-profile-image/', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        },\n        body: formData\n      });\n      if (response.ok) {\n        const result = await response.json();\n        // อัพเดต profile ใน state\n        setProfile(prev => ({\n          ...prev,\n          profile_image: result.profile_image\n        }));\n        return {\n          success: true,\n          data: result\n        };\n      } else {\n        const errorData = await response.json();\n        throw new Error(errorData.detail || 'ไม่สามารถอัพโหลดรูปภาพได้');\n      }\n    } catch (err) {\n      console.error('Error uploading profile image:', err);\n      throw err;\n    }\n  };\n\n  // ฟังก์ชันสำหรับแสดงชื่อย่อ\n  const getInitials = fullName => {\n    if (!fullName) return 'U';\n    const names = fullName.split(' ');\n    if (names.length >= 2) {\n      return (names[0][0] + names[1][0]).toUpperCase();\n    }\n    return names[0][0].toUpperCase();\n  };\n\n  // ฟังก์ชันแสดงชื่อสั้น\n  const getDisplayName = fullName => {\n    if (!fullName) return 'User';\n    const names = fullName.split(' ');\n    if (names.length >= 2) {\n      return names[0]; // แสดงแค่ชื่อ\n    }\n    return fullName;\n  };\n\n  // ฟังก์ชันสำหรับ URL รูปโปรไฟล์\n  const getProfileImageUrl = () => {\n    if (!(profile !== null && profile !== void 0 && profile.profile_image)) return null;\n\n    // ตรวจสอบว่าเป็น URL เต็มหรือไม่\n    if (profile.profile_image.startsWith('http')) {\n      return profile.profile_image;\n    }\n\n    // ถ้าเป็น path สัมพัทธ์ ให้เพิ่ม base URL\n    return `http://localhost:8000${profile.profile_image}`;\n  };\n\n  // ฟังก์ชันรีเฟรชข้อมูล Profile\n  const refreshProfile = () => {\n    fetchProfile();\n  };\n\n  // เรียกดึงข้อมูลเมื่อ component mount หรือ user เปลี่ยน\n  useEffect(() => {\n    fetchProfile();\n  }, [user, isAuthenticated]);\n  return {\n    profile,\n    loading,\n    error,\n    updateProfile,\n    uploadProfileImage,\n    refreshProfile,\n    getInitials,\n    getDisplayName,\n    getProfileImageUrl,\n    // Helper functions\n    fullName: (profile === null || profile === void 0 ? void 0 : profile.full_name) || (user === null || user === void 0 ? void 0 : user.full_name),\n    email: (profile === null || profile === void 0 ? void 0 : profile.email) || (user === null || user === void 0 ? void 0 : user.email),\n    userType: (profile === null || profile === void 0 ? void 0 : profile.user_type) || (user === null || user === void 0 ? void 0 : user.user_type),\n    initials: getInitials((profile === null || profile === void 0 ? void 0 : profile.full_name) || (user === null || user === void 0 ? void 0 : user.full_name)),\n    displayName: getDisplayName((profile === null || profile === void 0 ? void 0 : profile.full_name) || (user === null || user === void 0 ? void 0 : user.full_name)),\n    profileImageUrl: getProfileImageUrl()\n  };\n};\n_s(useProfile, \"eTJZQ1Xdj2FpxBafO+8w7yc0cgo=\", false, function () {\n  return [useAuth];\n});\nexport default useProfile;","map":{"version":3,"names":["useState","useEffect","useAuth","useProfile","_s","user","isAuthenticated","profile","setProfile","loading","setLoading","error","setError","fetchProfile","token","localStorage","getItem","response","fetch","method","headers","ok","profileData","json","Error","err","console","message","updateProfile","formData","body","updatedProfile","success","data","errorData","detail","uploadProfileImage","imageFile","FormData","append","result","prev","profile_image","getInitials","fullName","names","split","length","toUpperCase","getDisplayName","getProfileImageUrl","startsWith","refreshProfile","full_name","email","userType","user_type","initials","displayName","profileImageUrl"],"sources":["D:/ai-resume-screening-system/frontend/src/hooks/useProfile.js"],"sourcesContent":["// frontend/src/hooks/useProfile.js - Custom Hook สำหรับจัดการ Profile\r\nimport { useState, useEffect } from 'react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\n\r\nconst useProfile = () => {\r\n  const { user, isAuthenticated } = useAuth();\r\n  const [profile, setProfile] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  // ฟังก์ชันดึงข้อมูล Profile\r\n  const fetchProfile = async () => {\r\n    if (!isAuthenticated() || !user) {\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      const token = localStorage.getItem('access_token');\r\n      const response = await fetch('http://localhost:8000/api/auth/profile/', {\r\n        method: 'GET',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (response.ok) {\r\n        const profileData = await response.json();\r\n        setProfile(profileData);\r\n      } else {\r\n        throw new Error('ไม่สามารถดึงข้อมูลโปรไฟล์ได้');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error fetching profile:', err);\r\n      setError(err.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // ฟังก์ชันอัพเดต Profile\r\n  const updateProfile = async (formData) => {\r\n    if (!isAuthenticated()) {\r\n      throw new Error('กรุณาเข้าสู่ระบบ');\r\n    }\r\n\r\n    try {\r\n      const token = localStorage.getItem('access_token');\r\n      const response = await fetch('http://localhost:8000/api/auth/profile/', {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n        },\r\n        body: formData, // ใช้ FormData สำหรับการอัพโหลดไฟล์\r\n      });\r\n\r\n      if (response.ok) {\r\n        const updatedProfile = await response.json();\r\n        setProfile(updatedProfile);\r\n        return { success: true, data: updatedProfile };\r\n      } else {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.detail || 'ไม่สามารถอัพเดตโปรไฟล์ได้');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error updating profile:', err);\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  // ฟังก์ชันอัพโหลดรูปโปรไฟล์\r\n  const uploadProfileImage = async (imageFile) => {\r\n    if (!isAuthenticated()) {\r\n      throw new Error('กรุณาเข้าสู่ระบบ');\r\n    }\r\n\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('profile_image', imageFile);\r\n\r\n      const token = localStorage.getItem('access_token');\r\n      const response = await fetch('http://localhost:8000/api/auth/upload-profile-image/', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n        },\r\n        body: formData,\r\n      });\r\n\r\n      if (response.ok) {\r\n        const result = await response.json();\r\n        // อัพเดต profile ใน state\r\n        setProfile(prev => ({\r\n          ...prev,\r\n          profile_image: result.profile_image\r\n        }));\r\n        return { success: true, data: result };\r\n      } else {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.detail || 'ไม่สามารถอัพโหลดรูปภาพได้');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error uploading profile image:', err);\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  // ฟังก์ชันสำหรับแสดงชื่อย่อ\r\n  const getInitials = (fullName) => {\r\n    if (!fullName) return 'U';\r\n    \r\n    const names = fullName.split(' ');\r\n    if (names.length >= 2) {\r\n      return (names[0][0] + names[1][0]).toUpperCase();\r\n    }\r\n    return names[0][0].toUpperCase();\r\n  };\r\n\r\n  // ฟังก์ชันแสดงชื่อสั้น\r\n  const getDisplayName = (fullName) => {\r\n    if (!fullName) return 'User';\r\n    \r\n    const names = fullName.split(' ');\r\n    if (names.length >= 2) {\r\n      return names[0]; // แสดงแค่ชื่อ\r\n    }\r\n    return fullName;\r\n  };\r\n\r\n  // ฟังก์ชันสำหรับ URL รูปโปรไฟล์\r\n  const getProfileImageUrl = () => {\r\n    if (!profile?.profile_image) return null;\r\n    \r\n    // ตรวจสอบว่าเป็น URL เต็มหรือไม่\r\n    if (profile.profile_image.startsWith('http')) {\r\n      return profile.profile_image;\r\n    }\r\n    \r\n    // ถ้าเป็น path สัมพัทธ์ ให้เพิ่ม base URL\r\n    return `http://localhost:8000${profile.profile_image}`;\r\n  };\r\n\r\n  // ฟังก์ชันรีเฟรชข้อมูล Profile\r\n  const refreshProfile = () => {\r\n    fetchProfile();\r\n  };\r\n\r\n  // เรียกดึงข้อมูลเมื่อ component mount หรือ user เปลี่ยน\r\n  useEffect(() => {\r\n    fetchProfile();\r\n  }, [user, isAuthenticated]);\r\n\r\n  return {\r\n    profile,\r\n    loading,\r\n    error,\r\n    updateProfile,\r\n    uploadProfileImage,\r\n    refreshProfile,\r\n    getInitials,\r\n    getDisplayName,\r\n    getProfileImageUrl,\r\n    // Helper functions\r\n    fullName: profile?.full_name || user?.full_name,\r\n    email: profile?.email || user?.email,\r\n    userType: profile?.user_type || user?.user_type,\r\n    initials: getInitials(profile?.full_name || user?.full_name),\r\n    displayName: getDisplayName(profile?.full_name || user?.full_name),\r\n    profileImageUrl: getProfileImageUrl(),\r\n  };\r\n};\r\n\r\nexport default useProfile;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}